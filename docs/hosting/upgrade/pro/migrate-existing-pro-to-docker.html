<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Migrate an existing Passbolt PRO to a new Docker</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         © 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Migrate an existing Passbolt PRO to a new Docker" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-docker">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2021-09-16-migrate-existing-pro-to-docker.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-docker.html"><span>migrate-existing-pro-to-docker</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Migrate an existing Passbolt PRO to a new Docker</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <p>This document describes how to migrate an existing passbolt to a new  server.</p>

    <h2 id="pre-requisites">Pre-requisites</h2>

    <p>For this tutorial, you will need:</p>
    <ul>
      <li>Passbolt installed on an old server</li>
      <li>A new server with Docker</li>
    </ul>

    <h2 id="backup-the-existing-data">Backup the existing data</h2>

    <p>Prior to the migration you will need to backup the existing passbolt instance data. Please refer to <a href="/hosting/backup">the official backup documentations</a>.</p>

    <p>Depending on your SSL configuration you might need to copy the certificate and key from the existing instance.</p>

    <p>Don’t delete the existing instance yet!</p>

    <h2 id="prepare-the-new-server">Prepare the new server</h2>

    <p>Create a fresh new Passbolt instance on Docker following <a href="/hosting/install/pro/docker.html">this documentation</a>.</p>

    <h2 id="migrate-the-data">Migrate the data</h2>

    <h3 id="stop-running-containers">Stop running containers</h3>

    <p>At this step, you should have a running empty Passbolt instance running on your server. We will now stop it and delete the database volume.</p>

    <p>If you have chosen the <code class="language-plaintext highlighter-rouge">docker compose</code> install, you just have to delete the volumes you created with this command (don’t forget the <code class="language-plaintext highlighter-rouge">-v</code>):</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose <span class="nt">-f</span> docker-compose-pro.yaml down <span class="nt">-v</span>
</code></pre></div>    </div>

    <p>If you have chosen to run docker containers, stop them and delete the database volume:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stop passbolt-container-name
docker stop passbolt-database-name
docker volume rm passbolt-database-volume-name
</code></pre></div>    </div>

    <p>Of course, replace containers and volume name with your own !</p>

    <h3 id="restore-your-database">Restore your database</h3>

    <p>According to <a href="https://hub.docker.com/_/mariadb">MariaDB documentation on Docker Hub</a>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables.

Furthermore, it will execute files with extensions .sh, .sql, .sql.gz, and .sql.xz that are found in /docker-entrypoint-initdb.d. Files will be executed in alphabetical order. .sh files without file execute permission are sourced rather than executed.

You can easily populate your mariadb services by mounting a SQL dump into that directory and provide custom images with contributed data. SQL files will be imported by default to the database specified by the MARIADB_DATABASE / MYSQL_DATABASE variable.
</code></pre></div>    </div>

    <p>This means you just have to mount your database backup file on <code class="language-plaintext highlighter-rouge">/docker-entrypoint-initdb.d</code> folder of the database container.</p>

    <p>Edit your docker-compose-pro.yaml file and add a volume mount in the db service:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volumes:
  - database_volume:/var/lib/mysql
  - ./path/to/your/database/dump.sql:/docker-entrypoint-initdb.d/dump.sql
</code></pre></div>    </div>

    <h3 id="set-your-gpg-server-keys-fingerprint-and-email">Set your GPG server keys fingerprint and email</h3>

    <p>In the scope of a migration to docker, you need to add 2 environment variables to the passbolt service
related to the GPG server keys fingerprint and email address.</p>

    <p>Get them from your backed up keys:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpg --show-keys /path/to/serverkey.asc
pub   rsa2048 2022-01-20 [SC]
      43F978AFF88B53F5ABBD12C87D5E40A4C43926ED
uid                      Passbolt default user &lt;passbolt@yourdomain.com&gt;
sub   rsa2048 2022-01-20 [E]
</code></pre></div>    </div>

    <p>In the above output, fingerprint is <code class="language-plaintext highlighter-rouge">43F978AFF88B53F5ABBD12C87D5E40A4C43926ED</code> and email address is <code class="language-plaintext highlighter-rouge">passbolt@yourdomain.com</code>.</p>

    <p>Add the environment variables in your <code class="language-plaintext highlighter-rouge">docker-compose-pro.yaml</code> file (replace with your own values):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:
  passbolt:
    environment:
      PASSBOLT_GPG_SERVER_KEY_FINGERPRINT: "43F978AFF88B53F5ABBD12C87D5E40A4C43926ED"
      PASSBOLT_KEY_EMAIL: "passbolt@yourdomain.com"
</code></pre></div>    </div>

    <h3 id="start-your-containers">Start your containers</h3>

    <p>You can now start your database and passbolt containers, your database will be restored at the database container start.</p>

    <h3 id="restore-gpg-server-keys">Restore GPG server keys</h3>

    <p>Copy the GPG you backed up in your container:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker cp serverkey_private.asc your-passbolt-container:/etc/passbolt/gpg/serverkey_private.asc
docker cp serverkey.asc your-passbolt-container:/etc/passbolt/gpg/serverkey.asc
</code></pre></div>    </div>

    <p>Then set correct rights:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey_private.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey_private.asc
</code></pre></div>    </div>

    <h3 id="restore-avatars-if-you-are-coming-from-prior-32">Restore avatars (if you are coming from prior 3.2)</h3>

    <div class="message warning">
    <p>
        This step is needed only if you come from Passbolt version prior to 3.2. Since 3.2, avatars are stored in database
    </p>
    
</div>

    <p>Extract the avatars to the Passbolt docker container:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat passbolt-avatars.tar.gz | docker exec -i your-passbolt-container tar -C /usr/share/php/passbolt/ -xzf -
</code></pre></div>    </div>

    <p>Then set correct rights to the avatars:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -it your-passbolt-container chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/avatar
</code></pre></div>    </div>

    <h3 id="thats-it">That’s it</h3>

    <p>If your passbolt URL has changed, you will have to proceed to an <a href="/faq/start/account-recover">account recovery</a>.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
September
29th,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when updating passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        🍪 &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script src="https://consent.cookiebot.com/uc.js" data-cbid="900808a8-f178-4994-b2ad-66bf3ccca5f7" data-blockingmode="auto" strategy="beforeInteractive"></script>
<script src="https://help.passbolt.com/assets/js/matomo-tag-manager.js"></script>
<script src="https://help.passbolt.com/assets/js/matomo-analytics.js"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>
